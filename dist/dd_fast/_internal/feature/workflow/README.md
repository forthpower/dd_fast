# Primer Workflow 可视化编辑器

一个强大的文件管理器风格可视化工具，用于解析、浏览和导出Primer支付平台的workflow配置。采用直观的文件夹结构和树形导航，让复杂的Workflow变得清晰易读。

## 🚀 功能特性

### 📁 文件管理器界面
- **文件夹分类**: 自动将不同类型的节点分类到对应文件夹
  - 🎯 触发器文件夹 - 包含所有支付触发器
  - 🔀 条件判断文件夹 - 包含所有业务逻辑判断
  - ⚙️ 支付处理文件夹 - 包含所有支付处理器配置
- **树形导航**: 支持展开/折叠文件夹，清晰的层次结构
- **面包屑导航**: 显示当前位置，支持快速返回上级目录
- **智能搜索**: 实时搜索节点名称和描述，快速定位配置

### 📋 详细配置展示
- **节点详情**: 点击任意节点查看完整的配置信息
- **分类展示**: 按功能分类显示处理器、3DS、欺诈检测等配置
- **属性卡片**: 清晰的卡片式布局展示各种配置参数
- **条件列表**: 详细展示条件判断的逻辑表达式
- **状态标识**: 清晰的状态标识和配置摘要

### 📁 文件管理
- **JSON导入**: 支持拖拽或选择Primer导出的JSON文件
- **格式解析**: 自动解析Primer workflow格式并转换为可视化
- **导出功能**: 将编辑后的workflow导出为标准Primer JSON格式
- **本地保存**: 支持保存到浏览器本地存储

### 🎨 用户体验
- **响应式设计**: 适配桌面和移动设备
- **直观导航**: 熟悉的文件管理器界面，易于上手
- **实时搜索**: 输入关键词即时筛选节点
- **状态反馈**: 操作成功/失败的实时提示
- **键盘支持**: 支持ESC键清除搜索等快捷键

## 📖 使用指南

### 1. 加载Workflow
- **方法一**: 拖拽JSON文件到上传区域
- **方法二**: 点击上传区域选择文件
- **方法三**: 使用内置的示例数据开始

### 2. 查看Workflow信息
加载文件后，左侧面板会显示：
- Workflow名称
- ID和版本信息
- 当前状态
- 节点总数

### 3. 浏览Workflow
- **文件夹导航**: 点击文件夹展开/折叠内容
- **节点选择**: 点击任意节点查看详细配置
- **搜索功能**: 在搜索框中输入关键词快速定位
- **面包屑导航**: 使用面包屑快速返回上级目录

### 4. 查看节点详情
- **基本信息**: 查看节点的基本配置信息
- **处理器配置**: 查看支付处理器和3DS设置
- **欺诈检测**: 查看预授权和后授权检测配置
- **自动操作**: 查看自动捕获和下一步操作设置

### 5. 导出Workflow
- 点击顶部"导出JSON"按钮
- 系统会生成符合Primer格式的JSON文件
- 文件会自动下载到本地

## 🛠️ 技术架构

### 前端技术栈
- **HTML5**: 语义化结构和现代Web标准
- **CSS3**: 响应式设计、动画效果、渐变背景
- **Vanilla JavaScript**: 原生JS实现，无外部依赖
- **SVG**: 用于绘制连接线和箭头

### 核心组件
- **WorkflowExplorer**: 主控制器类
- **文件夹系统**: 管理Workflow的层次化组织结构
- **树形导航**: 处理文件夹展开/折叠和导航逻辑
- **搜索系统**: 实现实时搜索和筛选功能
- **详情面板**: 展示节点详细配置信息
- **文件解析器**: 转换Primer JSON格式
- **导出器**: 生成标准JSON输出

### 数据流程
```
Primer JSON → 解析器 → 文件夹结构 → 树形导航 → 详情展示 → 导出器 → 新JSON
```

## 📋 支持的Primer元素

### 触发器 (TRIGGER)
- Payment created trigger
- 自定义触发器配置
- 条件分支设置

### 条件 (CONDITION)
- MULTI_IF 多重条件
- SINGLE_IF 单一条件
- 字符串比较操作
- 布尔值判断

### 应用 (APPLICATION)
- Authorize payment 授权支付
- 处理器配置 (Airwallex, Adyen, Stripe)
- 3DS设置 (FORCE_3DS, ADAPTIVE_3DS, DO_NOT_PERFORM)
- 欺诈检测配置

## 🎯 使用场景

### 1. Workflow分析
- 快速理解复杂workflow的整体结构
- 通过文件夹分类快速定位特定类型的配置
- 详细查看每个节点的具体参数设置

### 2. 配置审查
- 使用搜索功能快速找到特定处理器或配置
- 通过详情面板全面了解节点配置
- 识别配置不一致或潜在问题

### 3. 团队协作
- 清晰的文件夹结构便于团队成员理解
- 详细的配置展示便于讨论和决策
- 导出功能支持配置的版本管理

## 🔧 自定义配置

### 添加新的节点类型
在`WorkflowExplorer`类中扩展：
```javascript
// 在buildFolderStructure方法中添加新的文件夹分类
// 在extractProperties方法中添加新的属性提取逻辑
// 在generateDetailContent方法中添加新的详情展示模板
```

### 自定义样式
修改CSS变量来调整外观：
```css
:root {
  --primary-color: #667eea;
  --secondary-color: #764ba2;
  --success-color: #48bb78;
  --warning-color: #ed8936;
}
```

## 🐛 故障排除

### 常见问题

**Q: JSON文件无法加载**
A: 确保文件是有效的Primer导出格式，包含workflow_source字段

**Q: 搜索功能不工作**
A: 确保在搜索框中输入了有效的关键词，支持节点名称和描述搜索

**Q: 文件夹无法展开**
A: 点击文件夹名称左侧的箭头图标来展开/折叠文件夹

**Q: 节点详情不显示**
A: 确保点击了具体的节点（不是文件夹），详情面板才会显示内容

## 📄 文件结构

```
primer/
├── workflow-explorer.html      # 可视化编辑器主界面
├── workflow-explorer.js        # 可视化编辑器核心逻辑
├── explorer-demo.html          # 演示页面
├── README.md                   # 使用说明文档
├── workflow_analysis.md        # Workflow分析文档
├── workflow_flowchart.txt      # ASCII流程图
├── FINAL_SUMMARY.md            # 项目总结
└── workflows_export_*.json     # Primer导出的JSON文件
```

## 🚀 快速开始

1. 打开 `workflow-explorer.html` 文件
2. 拖拽您的Primer JSON文件到上传区域
3. 在可视化编辑器中浏览workflow的文件夹结构
4. 点击节点查看详细的配置信息
5. 使用搜索功能快速定位特定配置
6. 点击"导出JSON"按钮保存workflow配置

## 📞 支持

如果您在使用过程中遇到问题或有改进建议，请：
1. 检查浏览器控制台的错误信息
2. 确认JSON文件格式正确
3. 尝试使用示例数据进行测试

---

**享受您的可视化workflow编辑体验！** 🎉
